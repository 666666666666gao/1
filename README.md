# Crack Segmentation é¡¹ç›®è¯´æ˜

æœ¬é¡¹ç›®åŸºäºæ·±åº¦å­¦ä¹ å®ç°æ··å‡åœŸè£‚ç¼åˆ†å‰²ï¼Œæ”¯æŒå¤šç§ä¸»æµæ¨¡å‹ï¼Œå…·å¤‡è‡ªåŠ¨åŒ–è®­ç»ƒã€è¶…å‚æ•°ä¼˜åŒ–ã€æ‰¹é‡é¢„æµ‹ã€è‡ªåŠ¨è¯„ä¼°ã€ä¸°å¯Œå¯è§†åŒ–å’Œè¯¦ç»†ç»“æœåˆ†æï¼Œé€‚åˆç§‘ç ”ã€å·¥ç¨‹ã€è¯¾ç¨‹è®¾è®¡ç­‰å¤šåœºæ™¯ã€‚

---

## ğŸ“ ç›®å½•ç»“æ„ä¸åŠŸèƒ½è¯´æ˜

| æ–‡ä»¶/æ–‡ä»¶å¤¹         | ä¸»è¦åŠŸèƒ½ä¸ç»†èŠ‚ |
|---------------------|-------------------------------------------------------------------|
| main_dev.py         | è®­ç»ƒä¸»å…¥å£ï¼Œæ”¯æŒè¶…å‚æ•°ä¼˜åŒ–ã€æ—©åœã€æ–­ç‚¹ç»­è®­ã€è‡ªåŠ¨ä¿å­˜æœ€ä¼˜æ¨¡å‹ã€è®­ç»ƒæ›²çº¿å¯è§†åŒ– |
| predict.py          | æ‰¹é‡é¢„æµ‹ä¸è‡ªåŠ¨å‚æ•°æœç´¢ï¼Œæ”¯æŒæœ€ä½³å‚æ•°ä¿å­˜/åŠ è½½ã€åå¤„ç†ã€ç»“æœå¯è§†åŒ–           |
| test.py             | å¤šæ¨¡å‹å¯¹æ¯”æµ‹è¯•ï¼ŒéšæœºæŠ½æ ·ã€è¯„ä¼°æŒ‡æ ‡å±•ç¤ºã€æ©ç å¯è§†åŒ–                        |
| eval.py             | æ‰¹é‡è¯„ä¼°ï¼Œè¾“å‡ºå„ç±»åˆ†å‰²æŒ‡æ ‡ï¼ˆF1ã€IoUç­‰ï¼‰                                   |
| model.py            | UNetã€LMM_Netç­‰æ¨¡å‹ç»“æ„å®šä¹‰                                               |
| efficientnet.py     | EfficientCrackNetæ¨¡å‹ç»“æ„å®ç°                                            |
| mobileVitblock.py   | MobileViTç›¸å…³æ¨¡å—å®ç°                                                    |
| utils.py            | æ•°æ®é›†åŠ è½½ã€æ•°æ®å¢å¼ºã€å·¥å…·å‡½æ•°ã€æƒé‡åˆå§‹åŒ–ç­‰                              |
| loss_functions.py   | BCEã€Diceã€IoUç­‰æŸå¤±å‡½æ•°å®ç°                                             |
| eval_metrics.py     | è¯„ä¼°æŒ‡æ ‡å‡½æ•°ï¼ˆF1ã€IoUç­‰ï¼‰                                                |
| data_preprocessing.py | æ•°æ®é¢„å¤„ç†è„šæœ¬ï¼ˆå¦‚æ ¼å¼è½¬æ¢ã€åˆ‡ç‰‡ç­‰ï¼‰                                   |
| sample_img_extraction.py | æ ·æœ¬å›¾ç‰‡æå–è„šæœ¬                                                    |
| check_weights.py    | æƒé‡æ–‡ä»¶æ£€æŸ¥å·¥å…·                                                        |
| DeepCrack/          | æ•°æ®é›†ç›®å½•ï¼Œå«è®­ç»ƒ/éªŒè¯/æµ‹è¯•å›¾ç‰‡åŠæ©ç                                    |
| saved_models/       | è®­ç»ƒè¿‡ç¨‹ä¸­è‡ªåŠ¨ä¿å­˜çš„æ¨¡å‹æƒé‡                                             |
| predictions/        | é¢„æµ‹ç»“æœè¾“å‡ºç›®å½•                                                        |
| plots/              | è®­ç»ƒ/éªŒè¯æ›²çº¿ã€æµç¨‹å›¾ã€ç»“æœå¯è§†åŒ–                                       |
| best_params/        | è‡ªåŠ¨å‚æ•°æœç´¢ä¿å­˜çš„æœ€ä½³å‚æ•°json                                           |
| .gitignore          | Gitå¿½ç•¥é…ç½®ï¼Œé˜²æ­¢å¤§æ–‡ä»¶/ä¸­é—´ç»“æœä¸Šä¼                                      |

---

## ğŸŒŸ EfficientCrackNet æ¨¡å‹æ¶æ„è¯¦è§£

EfficientCrackNet æ˜¯æœ¬é¡¹ç›®çš„é«˜æ•ˆè£‚ç¼åˆ†å‰²ä¸»åŠ›æ¨¡å‹ï¼Œèåˆäº† EfficientNet çš„é«˜æ•ˆç‰¹å¾æå–èƒ½åŠ›ä¸è½»é‡åŒ–è§£ç ç»“æ„ï¼Œé€‚åˆè¾¹ç¼˜è®¾å¤‡å’Œå¤§è§„æ¨¡å·¥ç¨‹åº”ç”¨ã€‚

### EfficientCrackNet ç»“æ„æµç¨‹å›¾
```mermaid
graph TD
    A[è¾“å…¥å›¾åƒ] --> B[EfficientNetä¸»å¹²ç‰¹å¾æå–]
    B --> C[å¤šå°ºåº¦ç‰¹å¾èåˆ]
    C --> D[è½»é‡è§£ç å™¨ï¼ˆä¸Šé‡‡æ ·+å·ç§¯ï¼‰]
    D --> E[åˆ†å‰²å¤´ï¼ˆ1x1å·ç§¯+Sigmoidï¼‰]
    E --> F[è¾“å‡ºæ©ç ]
```
- **ä¸»å¹²ç½‘ç»œ**ï¼šé‡‡ç”¨ EfficientNetï¼ˆå¦‚B0/B1ï¼‰æå–å¤šå±‚ç‰¹å¾ï¼Œå…¼é¡¾é€Ÿåº¦ä¸ç²¾åº¦ã€‚
- **å¤šå°ºåº¦èåˆ**ï¼šèåˆä¸åŒå±‚æ¬¡çš„ç‰¹å¾ï¼Œæå‡å¯¹ç»†å°è£‚ç¼çš„æ„ŸçŸ¥ã€‚
- **è½»é‡è§£ç å™¨**ï¼šé‡‡ç”¨ä¸Šé‡‡æ ·+å·ç§¯ç»“æ„ï¼Œé€æ­¥æ¢å¤ç©ºé—´åˆ†è¾¨ç‡ã€‚
- **åˆ†å‰²å¤´**ï¼š1x1å·ç§¯è¾“å‡ºå•é€šé“æ¦‚ç‡å›¾ï¼ŒSigmoidæ¿€æ´»å¾—åˆ°åƒç´ çº§åˆ†å‰²ã€‚

### EfficientCrackNet ä¸»è¦ä¼˜ç‚¹
- è®¡ç®—é‡å°ï¼Œæ¨ç†é€Ÿåº¦å¿«ï¼Œé€‚åˆå¤§æ‰¹é‡æˆ–è¾¹ç¼˜éƒ¨ç½²ã€‚
- å¤šå°ºåº¦ç‰¹å¾èåˆï¼Œæå‡å¯¹ç»†å¾®è£‚ç¼çš„æ£€æµ‹èƒ½åŠ›ã€‚
- ç»“æ„ç®€æ´ï¼Œæ˜“äºæ‰©å±•å’Œè¿ç§»ã€‚

---

## ğŸš¦ è®­ç»ƒã€é¢„æµ‹ã€è¯„ä¼°æµç¨‹å›¾ä¸è¯¦ç»†è¯´æ˜

### 1. è®­ç»ƒæµç¨‹
```mermaid
flowchart TD
    A[åŠ è½½æ•°æ®é›†] --> B[æ•°æ®å¢å¼º/é¢„å¤„ç†]
    B --> C[æ¨¡å‹åˆå§‹åŒ–]
    C --> D{æ˜¯å¦åŠ è½½é¢„è®­ç»ƒæƒé‡}
    D --æ˜¯--> E[åŠ è½½æƒé‡]
    D --å¦--> F[éšæœºåˆå§‹åŒ–]
    E & F --> G[è®­ç»ƒå¾ªç¯]
    G --> H[éªŒè¯é›†è¯„ä¼°]
    H --> I{æ—©åœ/ä¿å­˜æœ€ä¼˜æ¨¡å‹}
    I --æ»¡è¶³æ¡ä»¶--> J[ä¿å­˜æƒé‡/æ›²çº¿]
    I --æœªæ»¡è¶³--> G
    J --> K[è®­ç»ƒç»“æŸ]
```
- **åŠ è½½æ•°æ®é›†**ï¼šæ”¯æŒDeepCrackç­‰å¤šç§æ ¼å¼ï¼Œè‡ªåŠ¨åˆ†train/val/testã€‚
- **æ•°æ®å¢å¼º/é¢„å¤„ç†**ï¼šæ—‹è½¬ã€ç¿»è½¬ã€è£å‰ªã€å™ªå£°ã€å½’ä¸€åŒ–ç­‰ã€‚
- **æ¨¡å‹åˆå§‹åŒ–**ï¼šæ”¯æŒUNetã€LMM_Netã€EfficientCrackNetç­‰ã€‚
- **é¢„è®­ç»ƒæƒé‡**ï¼šå¯é€‰ï¼Œæå‡æ”¶æ•›é€Ÿåº¦ã€‚
- **è®­ç»ƒå¾ªç¯**ï¼šæ”¯æŒå¤šæŸå¤±è”åˆã€æ¢¯åº¦ç´¯ç§¯ã€è‡ªåŠ¨æ··åˆç²¾åº¦ã€‚
- **éªŒè¯é›†è¯„ä¼°**ï¼šæ¯epochè¯„ä¼°F1/IoUç­‰ã€‚
- **æ—©åœ/ä¿å­˜æœ€ä¼˜æ¨¡å‹**ï¼šé˜²æ­¢è¿‡æ‹Ÿåˆï¼Œè‡ªåŠ¨ä¿å­˜æœ€ä¼˜æƒé‡ã€‚
- **è®­ç»ƒç»“æŸ**ï¼šè¾“å‡ºè®­ç»ƒæ—¥å¿—å’Œæ›²çº¿ã€‚

### 2. é¢„æµ‹æµç¨‹
```mermaid
flowchart TD
    A[åŠ è½½æ¨¡å‹ä¸æƒé‡] --> B[åŠ è½½å›¾ç‰‡]
    B --> C{æ˜¯å¦è‡ªåŠ¨å‚æ•°æœç´¢}
    C --æ˜¯--> D[éå†å‚æ•°ç»„åˆ]
    D --> E[æ¨ç†+è¯„ä¼°]
    E --> F[ä¿å­˜æœ€ä½³å‚æ•°]
    C --å¦--> G[ç›´æ¥æ¨ç†]
    F & G --> H[åå¤„ç†+ä¿å­˜æ©ç ]
    H --> I[è¾“å‡ºå¯è§†åŒ–ç»“æœ]
```
- **è‡ªåŠ¨å‚æ•°æœç´¢**ï¼šéå†é˜ˆå€¼ã€æœ€å°é¢ç§¯ã€å½¢æ€å­¦æ ¸ï¼Œè‡ªåŠ¨é€‰æœ€ä¼˜ã€‚
- **æ‰¹é‡é¢„æµ‹**ï¼šæ”¯æŒæ–‡ä»¶å¤¹è¾“å…¥ï¼Œè‡ªåŠ¨ä¿å­˜æ©ç å’Œå¯è§†åŒ–ã€‚
- **åå¤„ç†**ï¼šå½¢æ€å­¦æ“ä½œã€è¿é€šåŸŸç­›é€‰ç­‰ã€‚

### 3. è¯„ä¼°æµç¨‹
```mermaid
flowchart TD
    A[åŠ è½½é¢„æµ‹æ©ç ä¸GT] --> B[æ‰¹é‡è¯„ä¼°]
    B --> C[è¾“å‡ºF1/IoUç­‰æŒ‡æ ‡]
    C --> D[ç”Ÿæˆè¯„ä¼°æŠ¥å‘Š]
```
- **æ‰¹é‡è¯„ä¼°**ï¼šæ”¯æŒå¤šæ¨¡å‹ã€å…¨é‡å›¾ç‰‡ã€‚
- **è¾“å‡ºæŒ‡æ ‡**ï¼šF1ã€IoUã€Precisionã€Recallç­‰ã€‚
- **ç”ŸæˆæŠ¥å‘Š**ï¼šå¯å¯¼å‡ºè¡¨æ ¼ã€ç»˜åˆ¶å¯¹æ¯”å›¾ã€‚

---

## ğŸ§® æŸå¤±å‡½æ•°ä¸è¯„ä¼°æŒ‡æ ‡

### 1. äºŒå€¼äº¤å‰ç†µï¼ˆBCEï¼‰
ç”¨äºåƒç´ çº§äºŒåˆ†ç±»ï¼Œè¡¡é‡é¢„æµ‹æ¦‚ç‡ä¸çœŸå®æ ‡ç­¾çš„å·®å¼‚ã€‚

å…¬å¼ï¼š

$$
\mathrm{BCE} = -\frac{1}{N} \sum_{i=1}^N \left[ y_i \log(p_i) + (1-y_i) \log(1-p_i) \right]
$$

> **Tips**ï¼šBCEé€‚ç”¨äºå‰æ™¯/èƒŒæ™¯æä¸å¹³è¡¡æ—¶ï¼Œå¸¸ä¸Dice/IoUè”åˆä½¿ç”¨ã€‚

### 2. Dice Lossï¼ˆDiceç³»æ•°æŸå¤±ï¼‰
è¡¡é‡é¢„æµ‹æ©ç ä¸çœŸå®æ©ç çš„é‡å ç¨‹åº¦ï¼Œé€‚åˆå¤„ç†ç±»åˆ«æä¸å¹³è¡¡çš„åˆ†å‰²ä»»åŠ¡ã€‚

$$
\mathrm{Dice} = \frac{2 \sum_i p_i y_i}{\sum_i p_i + \sum_i y_i}
$$

Dice Loss $= 1 - \mathrm{Dice}$

> **Tips**ï¼šDiceå¯¹å°ç›®æ ‡æ•æ„Ÿï¼Œå¸¸ç”¨äºåŒ»å­¦/è£‚ç¼ç­‰åˆ†å‰²ã€‚

### 3. IoU Lossï¼ˆäº¤å¹¶æ¯”æŸå¤±ï¼‰
è¡¡é‡é¢„æµ‹ä¸çœŸå®æ©ç çš„äº¤é›†ä¸å¹¶é›†æ¯”ä¾‹ã€‚

$$
\mathrm{IoU} = \frac{\sum_i p_i y_i}{\sum_i p_i + \sum_i y_i - \sum_i p_i y_i}
$$

IoU Loss $= 1 - \mathrm{IoU}$

> **Tips**ï¼šIoUæ˜¯ç«èµ›å’Œè®ºæ–‡å¸¸ç”¨ä¸»æŒ‡æ ‡ï¼Œè¶Šé«˜è¶Šå¥½ã€‚

### 4. F1 Scoreï¼ˆF1åˆ†æ•°ï¼‰
ç»¼åˆè€ƒè™‘ç²¾ç¡®ç‡ï¼ˆPrecisionï¼‰å’Œå¬å›ç‡ï¼ˆRecallï¼‰ï¼Œæ˜¯åˆ†å‰²å¸¸ç”¨çš„ç»¼åˆæŒ‡æ ‡ã€‚

$$
\mathrm{F1} = \frac{2 \cdot \mathrm{Precision} \cdot \mathrm{Recall}}{\mathrm{Precision} + \mathrm{Recall}}
$$

å…¶ä¸­ï¼š

$$
\mathrm{Precision} = \frac{TP}{TP + FP}
$$

$$
\mathrm{Recall} = \frac{TP}{TP + FN}
$$

> **Tips**ï¼šF1å…¼é¡¾æŸ¥å…¨ç‡å’ŒæŸ¥å‡†ç‡ï¼Œé€‚åˆä¸å‡è¡¡åˆ†å‰²ã€‚

---

## ğŸš€ ä¸»è¦åŠŸèƒ½æµç¨‹

### 1. æ€»ä½“æµç¨‹æ¦‚è§ˆ
```mermaid
flowchart TD
    æ•°æ®å‡†å¤‡ -->|æ•°æ®å¢å¼º| è®­ç»ƒ
    è®­ç»ƒ -->|ä¿å­˜æœ€ä¼˜æ¨¡å‹| é¢„æµ‹
    é¢„æµ‹ -->|è‡ªåŠ¨å‚æ•°æœç´¢| è¯„ä¼°
    è¯„ä¼° -->|ç”ŸæˆæŠ¥å‘Š| å¯è§†åŒ–
    å¯è§†åŒ– -->|å¯¹æ¯”åˆ†æ| ç»“æœæ€»ç»“
```

### 2. è®­ç»ƒã€é¢„æµ‹ã€è¯„ä¼°ç­‰è¯¦ç»†æµç¨‹è§ä¸Šæ–‡

---

## ğŸ“Š ç»“æœä¸è¯„ä¼°

- **è®­ç»ƒè¿‡ç¨‹**ï¼šæ¯è½®è®­ç»ƒ/éªŒè¯æŸå¤±ã€F1ã€IoUç­‰æŒ‡æ ‡è‡ªåŠ¨ä¿å­˜å¹¶ç»˜å›¾ï¼ˆè§ plots/ï¼‰ã€‚
- **é¢„æµ‹ç»“æœ**ï¼šæ¯å¼ å›¾ç‰‡çš„åˆ†å‰²æ©ç è‡ªåŠ¨ä¿å­˜ï¼ˆè§ predictions/ï¼‰ï¼Œæ”¯æŒåŸå›¾ä¸æ©ç å¯¹æ¯”å¯è§†åŒ–ã€‚
- **å¤šæ¨¡å‹å¯¹æ¯”**ï¼štest.py æ”¯æŒåŒä¸€å›¾ç‰‡å¤šæ¨¡å‹åˆ†å‰²æ•ˆæœå¯¹æ¯”ï¼ŒæŒ‡æ ‡ä¸€ç›®äº†ç„¶ã€‚
- **è¯„ä¼°æŠ¥å‘Š**ï¼ševal.py å¯æ‰¹é‡è¾“å‡ºæ‰€æœ‰å›¾ç‰‡çš„åˆ†å‰²æŒ‡æ ‡ï¼ˆF1ã€IoUã€Precisionã€Recallï¼‰ï¼Œå¯å¯¼å‡ºä¸ºè¡¨æ ¼æˆ–å¯è§†åŒ–å›¾ã€‚
- **å‚æ•°æœ€ä¼˜æ€§**ï¼špredict.py è‡ªåŠ¨æœç´¢å¹¶ä¿å­˜æœ€ä½³åå¤„ç†å‚æ•°ï¼Œä¿è¯åˆ†å‰²ç²¾åº¦æœ€å¤§åŒ–ã€‚

---

## ğŸ› ï¸ ä¾èµ–ç¯å¢ƒ
- Python 3.6+
- PyTorch 1.7+
- torchvision, numpy, opencv-python, scikit-learn, optuna, matplotlib, tqdm
- æ¨èç”¨ requirements.txt ç®¡ç†ä¾èµ–

---

## ğŸ“– å¿«é€Ÿä¸Šæ‰‹

### è®­ç»ƒ
```bash
python main_dev.py --model_name UNet --data_dir "DeepCrack" --data_name "deepcrack" --run_num 1 --epochs 100 --validate True
```

### è¶…å‚æ•°ä¼˜åŒ–è®­ç»ƒ
```bash
python main_dev.py --model_name UNet --data_dir "DeepCrack" --data_name "deepcrack" --run_num 1 --epochs 100 --optimize True --validate True
```

### é¢„æµ‹ï¼ˆè‡ªåŠ¨å‚æ•°æœç´¢ï¼‰
```bash
python predict.py --model_name UNet --model_path "saved_models/UNet/best_model_num_1.pt" --input_dir "DeepCrack/test_img" --mask_dir "DeepCrack/test_lab" --auto_search --output_dir predictions/UNet
```

### è¯„ä¼°
```bash
python eval.py --model_name UNet --pred_dir predictions/UNet --gt_dir DeepCrack/test_lab
```

### å¤šæ¨¡å‹å¯¹æ¯”
```bash
python test.py
```

---

## ğŸ“ è®¸å¯è¯
MIT License

---

> æœ¬é¡¹ç›®é€‚åˆç§‘ç ”ã€å·¥ç¨‹ã€è¯¾ç¨‹è®¾è®¡ç­‰å¤šåœºæ™¯ï¼Œæ¬¢è¿äºŒæ¬¡å¼€å‘ä¸è´¡çŒ®ï¼

---

å¦‚éœ€æ›´è¯¦ç»†çš„ API æ–‡æ¡£ã€å‚æ•°è¯´æ˜æˆ–è‡ªå®šä¹‰æµç¨‹å›¾ï¼Œæ¬¢è¿åœ¨ Issues åŒºç•™è¨€æˆ–æäº¤ PRï¼

---

## ğŸ“‚ æ•°æ®é›†ç»“æ„ä¸æ ·ä¾‹

å»ºè®®ç»“æ„å¦‚ä¸‹ï¼š
```
DeepCrack/
  train_img/   # è®­ç»ƒå›¾ç‰‡
  train_lab/   # è®­ç»ƒæ©ç 
  valid_img/   # éªŒè¯å›¾ç‰‡
  valid_lab/   # éªŒè¯æ©ç 
  test_img/    # æµ‹è¯•å›¾ç‰‡
  test_lab/    # æµ‹è¯•æ©ç 
```
- å›¾ç‰‡å’Œæ©ç æ–‡ä»¶åéœ€ä¸€ä¸€å¯¹åº”ã€‚
- æ”¯æŒå¤šç§æ ¼å¼ï¼ˆ.png/.jpg/.bmpç­‰ï¼‰ã€‚

---

## ğŸ“ˆ ç»“æœå¯è§†åŒ–ç®€æ˜æ•™ç¨‹

- è®­ç»ƒ/éªŒè¯æ›²çº¿è‡ªåŠ¨ä¿å­˜åœ¨ `plots/` ç›®å½•ã€‚
- é¢„æµ‹æ©ç å’ŒåŸå›¾å¯¹æ¯”å›¾è‡ªåŠ¨ä¿å­˜åœ¨ `predictions/` ç›®å½•ã€‚
- æ”¯æŒ `test.py` å¤šæ¨¡å‹å¯¹æ¯”å¯è§†åŒ–ã€‚
- å¯ç”¨ `matplotlib`/`opencv`/`tensorboard` è¿›ä¸€æ­¥è‡ªå®šä¹‰å¯è§†åŒ–ã€‚

---

## ğŸ› ï¸ å¸¸è§é—®é¢˜ FAQ & è°ƒä¼˜å»ºè®®

**Q1: è¯„ä¼°æŒ‡æ ‡ä¸é«˜æ€ä¹ˆåŠï¼Ÿ**
- æ£€æŸ¥æ•°æ®å¢å¼ºæ˜¯å¦åˆç†ï¼Œå°è¯•æ›´å¼º/æ›´å¼±å¢å¼ºã€‚
- è°ƒæ•´æŸå¤±å‡½æ•°æƒé‡ï¼ˆå¦‚alphaï¼‰ã€‚
- å°è¯•æ›´æ·±/æ›´æµ…çš„æ¨¡å‹ã€‚
- æ£€æŸ¥åå¤„ç†å‚æ•°æ˜¯å¦æœ€ä¼˜ã€‚

**Q2: è®­ç»ƒå¾ˆæ…¢/æ˜¾å­˜æº¢å‡ºï¼Ÿ**
- å‡å°batch sizeæˆ–å›¾ç‰‡åˆ†è¾¨ç‡ã€‚
- ä½¿ç”¨æ··åˆç²¾åº¦è®­ç»ƒï¼ˆAMPï¼‰ã€‚
- å…³é—­ä¸å¿…è¦çš„æ•°æ®å¢å¼ºã€‚

**Q3: é¢„æµ‹æ©ç å…¨é»‘/å…¨ç™½ï¼Ÿ**
- æ£€æŸ¥æ¨¡å‹æ˜¯å¦æ”¶æ•›ã€‚
- æ£€æŸ¥é˜ˆå€¼å’Œåå¤„ç†å‚æ•°ã€‚

**Q4: å¦‚ä½•è‡ªå®šä¹‰æ–°æ¨¡å‹/æŸå¤±/å¢å¼ºï¼Ÿ**
- åœ¨`model.py`/`loss_functions.py`/`utils.py`ä¸­æ–°å¢ç±»æˆ–å‡½æ•°ï¼ŒæŒ‰ç°æœ‰æ¥å£æ³¨å†Œå³å¯ã€‚

---

## ğŸ æ¨¡å‹è¾“å‡ºè°ƒè¯•ä¸æ’æŸ¥

ä¸ºæ–¹ä¾¿å®šä½æ¨¡å‹åˆ†å‰²å¼‚å¸¸ï¼ˆå¦‚é¢„æµ‹å…¨é»‘/å…¨ç™½ã€æ¦‚ç‡åˆ†å¸ƒå¼‚å¸¸ç­‰ï¼‰ï¼Œæœ¬é¡¹ç›®æ–°å¢äº†è°ƒè¯•è„šæœ¬ `debug_model_output.py`ï¼Œå¯ç”¨äºè¯¦ç»†åˆ†æå„æ¨¡å‹çš„è¾“å‡ºæ¦‚ç‡åˆ†å¸ƒã€æ¦‚ç‡å›¾ã€åå¤„ç†æ•ˆæœåŠè¯„ä¼°æŒ‡æ ‡ã€‚

### ä½¿ç”¨æ–¹æ³•

```bash
python debug_model_output.py
```

- éšæœºé€‰å–ä¸€å¼ æµ‹è¯•å›¾ç‰‡ï¼Œå¯¹UNetã€LMM_Netã€EfficientCrackNetåˆ†åˆ«æ¨ç†ã€‚
- è¾“å‡ºæ¯ä¸ªæ¨¡å‹çš„æ¦‚ç‡åˆ†å¸ƒç»Ÿè®¡ï¼ˆmin/max/mean/stdï¼‰ã€ä¸åŒé˜ˆå€¼ä¸‹çš„åƒç´ æ¯”ä¾‹ã€‚
- è‡ªåŠ¨ä¿å­˜æ¦‚ç‡çƒ­åŠ›å›¾ã€æ¦‚ç‡ç›´æ–¹å›¾ã€äºŒå€¼åŒ–ç»“æœåˆ° `debug_outputs/` ç›®å½•ã€‚
- æ‰“å°åå¤„ç†æ¯ä¸€æ­¥çš„ç™½è‰²åƒç´ æ¯”ä¾‹ã€è¿é€šåŸŸæ•°é‡ã€‚
- è‹¥æœ‰GTï¼Œè‡ªåŠ¨è®¡ç®—F1ã€IoUã€Precisionã€Recallç­‰æŒ‡æ ‡ã€‚

### å…¸å‹æ’æŸ¥å»ºè®®

- è‹¥æ¨¡å‹è¾“å‡ºæ¦‚ç‡åˆ†å¸ƒæçª„ï¼ˆå¦‚å…¨0.5å·¦å³ï¼‰ï¼Œé€šå¸¸ä¸ºæƒé‡æœªæ”¶æ•›ã€æƒé‡æ–‡ä»¶é”™è¯¯æˆ–æ¨ç†å½’ä¸€åŒ–ä¸ä¸€è‡´ã€‚
- è‹¥åå¤„ç†åå…¨é»‘/å…¨ç™½ï¼Œå»ºè®®å…ˆçœ‹æ¦‚ç‡åˆ†å¸ƒå’Œé˜ˆå€¼è®¾ç½®ï¼Œå†æ’æŸ¥æƒé‡å’Œè®­ç»ƒæ—¥å¿—ã€‚
- å…¶ä»–æ¨¡å‹æ­£å¸¸ä½†æŸä¸€æ¨¡å‹å¼‚å¸¸ï¼Œä¼˜å…ˆæ’æŸ¥è¯¥æ¨¡å‹æƒé‡å’Œè®­ç»ƒæµç¨‹ã€‚

---

## 3.3 æ•°æ®é¢„å¤„ç†æµç¨‹

### 3.3.1 å›¾åƒå¤„ç†

```mermaid
graph TD
    A[åŸå§‹å›¾åƒæ–‡ä»¶ï¼ˆ.jpg/.png/.tifï¼‰] --> B[è¯»å–ä¸ºPILæˆ–numpyæ•°ç»„]
    B --> C[å°ºå¯¸å½’ä¸€åŒ–/ç¼©æ”¾ï¼ˆæ ¹æ®æ¨¡å‹ç±»å‹è°ƒæ•´ï¼‰]
    C --> D[å½’ä¸€åŒ–å¤„ç†ï¼ˆå¦‚0-1æˆ–æ ‡å‡†åŒ–ï¼‰]
    D --> E[æ ¼å¼è½¬æ¢ï¼ˆRGBè½¬Tensor/float32ï¼‰]
    E --> F[å¯é€‰ï¼šæ·»åŠ å™ªå£°/æ¨¡ç³Šç­‰å¢å¼º]
    F --> G[è¾“å…¥æ¨¡å‹]
```
**è¯¦ç»†è¯´æ˜**ï¼š
- **è¯»å–**ï¼šæ”¯æŒå¤šç§æ ¼å¼ï¼Œä½¿ç”¨PILæˆ–tifffileè¯»å–ï¼Œä¿è¯é€šé“é¡ºåºä¸€è‡´ã€‚
- **å°ºå¯¸å½’ä¸€åŒ–/ç¼©æ”¾**ï¼šæ ¹æ®æ¨¡å‹ï¼ˆUNet:256x256, LMM_Net:112x224, EfficientCrackNet:192x256ï¼‰è‡ªåŠ¨è°ƒæ•´å›¾ç‰‡å°ºå¯¸ã€‚
- **å½’ä¸€åŒ–å¤„ç†**ï¼šå¦‚`transforms.Normalize(mean, std)`ï¼Œä¿è¯è¾“å…¥åˆ†å¸ƒä¸è®­ç»ƒä¸€è‡´ã€‚
- **æ ¼å¼è½¬æ¢**ï¼šPILè½¬Tensorï¼Œfloat32ï¼Œé€šé“é¡ºåºä¸º[C,H,W]ã€‚
- **å¯é€‰å¢å¼º**ï¼šå¦‚é«˜æ–¯å™ªå£°ã€æ¨¡ç³Šï¼ˆè§æ•°æ®å¢å¼ºéƒ¨åˆ†ï¼‰ï¼Œæå‡é²æ£’æ€§ã€‚

### 3.3.2 æ©ç å¤„ç†

```mermaid
graph TD
    A[åŸå§‹æ©ç æ–‡ä»¶ï¼ˆ.png/.bmpï¼‰] --> B[è¯»å–ä¸ºPIL/numpy]
    B --> C[å°ºå¯¸å½’ä¸€åŒ–/ç¼©æ”¾ï¼ˆä¸å›¾åƒåŒæ­¥ï¼‰]
    C --> D[äºŒå€¼åŒ–å¤„ç†ï¼ˆé˜ˆå€¼åŒ–0/1ï¼‰]
    D --> E[æ ¼å¼è½¬æ¢ï¼ˆè½¬Tensor/long/intï¼‰]
    E --> F[è¾“å…¥æ¨¡å‹æˆ–è¯„ä¼°]
```
**è¯¦ç»†è¯´æ˜**ï¼š
- **è¯»å–**ï¼šæ©ç ä¸å›¾åƒä¸€ä¸€å¯¹åº”ï¼Œæ”¯æŒå¤šæ ¼å¼ã€‚
- **å°ºå¯¸å½’ä¸€åŒ–/ç¼©æ”¾**ï¼šä¸å›¾åƒå®Œå…¨åŒæ­¥ï¼Œä¿è¯åƒç´ å¯¹é½ã€‚
- **äºŒå€¼åŒ–å¤„ç†**ï¼šæ‰€æœ‰éé›¶åƒç´ å½’ä¸º1ï¼ŒèƒŒæ™¯ä¸º0ï¼Œé€‚é…äºŒåˆ†ç±»åˆ†å‰²ã€‚
- **æ ¼å¼è½¬æ¢**ï¼šè½¬ä¸ºTensorï¼Œç±»å‹ä¸ºlong/intï¼Œä¾¿äºæŸå¤±å‡½æ•°è®¡ç®—ã€‚

### 3.3.3 æ•°æ®å¢å¼º

```mermaid
graph TD
    A[åŸå§‹å›¾åƒ/æ©ç ] --> B[éšæœºæ—‹è½¬ï¼ˆ-15~15Â°ï¼‰]
    B --> C[éšæœºæ°´å¹³/å‚ç›´ç¿»è½¬]
    C --> D[éšæœºç¼©æ”¾/è£å‰ªï¼ˆ0.8~1.2å€ï¼‰]
    D --> E[é¢œè‰²æ‰°åŠ¨ï¼ˆäº®åº¦/å¯¹æ¯”åº¦/é¥±å’Œåº¦/è‰²è°ƒï¼‰]
    E --> F[é«˜æ–¯å™ªå£°/æ¨¡ç³Š]
    F --> G[å¢å¼ºæ ·æœ¬ä¸æ©ç åŒæ­¥è¾“å‡º]
```
**è¯¦ç»†è¯´æ˜**ï¼š
- **éšæœºæ—‹è½¬**ï¼šå›¾åƒä¸æ©ç åŒæ­¥æ—‹è½¬ï¼Œæå‡æ–¹å‘é²æ£’æ€§ã€‚
- **éšæœºç¿»è½¬**ï¼šæ°´å¹³/å‚ç›´ç¿»è½¬ï¼Œå¢åŠ æ ·æœ¬å¤šæ ·æ€§ã€‚
- **ç¼©æ”¾/è£å‰ª**ï¼šéšæœºç¼©æ”¾åè£å‰ªæˆ–resizeï¼Œé˜²æ­¢æ¨¡å‹è¿‡æ‹Ÿåˆç‰¹å®šå°ºå¯¸ã€‚
- **é¢œè‰²æ‰°åŠ¨**ï¼šå¯¹RGBå›¾åƒè¿›è¡Œäº®åº¦ã€å¯¹æ¯”åº¦ã€é¥±å’Œåº¦ã€è‰²è°ƒæ‰°åŠ¨ï¼Œæ¨¡æ‹Ÿä¸åŒå…‰ç…§ã€‚
- **é«˜æ–¯å™ªå£°/æ¨¡ç³Š**ï¼šæ¨¡æ‹Ÿä¼ æ„Ÿå™¨å™ªå£°ã€æ¨¡ç³Šï¼Œæå‡æ¨¡å‹æŠ—å¹²æ‰°èƒ½åŠ›ã€‚
- **åŒæ­¥å¢å¼º**ï¼šæ‰€æœ‰å˜æ¢ä¿è¯å›¾åƒä¸æ©ç åŒæ­¥ï¼Œé¿å…æ ‡ç­¾é”™ä½ã€‚

> å…·ä½“å®ç°è¯¦è§`utils.py`çš„`DeepCrackDataset`å’Œ`CustomImageDataset`ï¼Œä»¥åŠ`data_preprocessing.py`çš„å¢å¼ºå‡½æ•°ã€‚

---
